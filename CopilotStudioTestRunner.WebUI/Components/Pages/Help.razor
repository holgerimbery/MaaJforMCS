@page "/help"
@layout MainLayout
@attribute [Authorize]
@inject IConfiguration Configuration
@inject IWebHostEnvironment HostEnv

<PageTitle>Help - Copilot Studio Test Runner</PageTitle>

<!-- Branding Hero -->
<div class="fade-in" style="display: flex; align-items: center; gap: 24px; margin-bottom: 40px; padding: 28px 32px; background: linear-gradient(135deg, #f8faff 0%, #eef3fc 100%); border-radius: 16px; border: 1px solid #dce6f7;">
    <img src="maaj-logo.png" alt="MaaJ Logo" style="width: 80px; height: 80px; object-fit: contain; flex-shrink: 0; filter: drop-shadow(0 2px 8px rgba(0,102,204,0.15));" />
    <div>
        <h1 style="font-size: 22px; font-weight: 700; color: #1f1f23; margin: 0 0 4px 0; line-height: 1.2;">
            Copilot Studio Test Runner
        </h1>
        <p style="font-size: 15px; font-weight: 500; color: #0066cc; margin: 0 0 6px 0;">
            Multi&#8209;Agent Assessment &amp; Judgement &mdash; MaaJ
        </p>
        <p style="font-size: 13px; color: #5f6368; margin: 0; line-height: 1.5;">
            Find documentation, source code, and learn more about this project
            <span style="margin-left: 10px; background: #e8f0fe; color: #0066cc; font-size: 11px; font-weight: 600; padding: 2px 10px; border-radius: 10px; vertical-align: middle;">
                v@(appVersion)
            </span>
        </p>
    </div>
</div>

<!-- Help Cards Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 48px;">
    <!-- GitHub & Documentation Card -->
    <div class="action-card fade-in" style="animation-delay: 0.1s;">
        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #24292e, #1a1e22); border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; flex-shrink: 0;">
            <i class="bi bi-github" style="font-size: 28px;"></i>
        </div>
        <h3 style="font-size: 16px; font-weight: 600; color: #1f1f23; margin: 0 0 8px 0;">Source & Documentation</h3>
        <p style="font-size: 14px; color: #5f5f5f; margin: 0 0 16px 0; line-height: 1.5;">Access the source code and comprehensive documentation for this project</p>
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <a href="https://github.com/holgerimbery/MaaJforMCS" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background-color: #f0f0f0; border-radius: 6px; text-decoration: none; color: #0066cc; font-size: 13px; font-weight: 500; transition: all 0.2s ease; border: 1px solid #e8eaed;">
                <i class="bi bi-code-square" style="font-size: 14px;"></i>
                <span>View Source Code</span>
            </a>
            <a href="https://github.com/holgerimbery/MaaJforMCS/wiki" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background-color: #f0f0f0; border-radius: 6px; text-decoration: none; color: #0066cc; font-size: 13px; font-weight: 500; transition: all 0.2s ease; border: 1px solid #e8eaed;">
                <i class="bi bi-book" style="font-size: 14px;"></i>
                <span>Read Documentation</span>
            </a>
        </div>
    </div>

    <!-- Author Card -->
    <div class="action-card fade-in" style="animation-delay: 0.2s;">
        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #0066cc, #003d99); border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; flex-shrink: 0;">
            <i class="bi bi-person-circle" style="font-size: 28px;"></i>
        </div>
        <h3 style="font-size: 16px; font-weight: 600; color: #1f1f23; margin: 0 0 8px 0;">About the Author</h3>
        <p style="font-size: 14px; color: #5f5f5f; margin: 0 0 16px 0; line-height: 1.5;">Created by Holger Imbery. Connect on GitHub or LinkedIn to learn more</p>
        <div style="display: flex; flex-direction: column; gap: 8px;">
            <a href="https://github.com/holgerimbery" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background-color: #f0f0f0; border-radius: 6px; text-decoration: none; color: #0066cc; font-size: 13px; font-weight: 500; transition: all 0.2s ease; border: 1px solid #e8eaed;">
                <i class="bi bi-github" style="font-size: 14px;"></i>
                <span>GitHub Profile</span>
            </a>
            <a href="https://www.linkedin.com/in/holgerimbery/" target="_blank" style="display: inline-flex; align-items: center; gap: 8px; padding: 8px 12px; background-color: #f0f0f0; border-radius: 6px; text-decoration: none; color: #0066cc; font-size: 13px; font-weight: 500; transition: all 0.2s ease; border: 1px solid #e8eaed;">
                <i class="bi bi-linkedin" style="font-size: 14px;"></i>
                <span>LinkedIn Profile</span>
            </a>
        </div>
    </div>

    <!-- Environment Info Card -->
    <div class="action-card fade-in" style="animation-delay: 0.3s;">
        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #37474f, #1c2529); border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; color: white; flex-shrink: 0;">
            <i class="bi bi-server" style="font-size: 28px;"></i>
        </div>
        <h3 style="font-size: 16px; font-weight: 600; color: #1f1f23; margin: 0 0 16px 0;">Runtime Environment</h3>
        <div style="display: flex; flex-direction: column; gap: 10px; font-size: 13px;">

            <!-- Hosting -->
            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 8px; border-bottom: 1px solid #f1f3f4;">
                <span style="color: #5f6368;"><i class="bi bi-box me-1"></i>Hosting</span>
                @if (isContainer)
                {
                    <span style="background: #e3f2fd; color: #1565c0; font-weight: 600; padding: 2px 10px; border-radius: 10px;">
                        <i class="bi bi-box-seam me-1"></i>Container
                    </span>
                }
                else
                {
                    <span style="background: #e8f5e9; color: #2e7d32; font-weight: 600; padding: 2px 10px; border-radius: 10px;">
                        <i class="bi bi-hdd me-1"></i>Bare Metal
                    </span>
                }
            </div>

            <!-- Auth mode -->
            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 8px; border-bottom: 1px solid #f1f3f4;">
                <span style="color: #5f6368;"><i class="bi bi-shield-lock me-1"></i>Authentication</span>
                @if (authEnabled)
                {
                    <span style="background: #e8f5e9; color: #2e7d32; font-weight: 600; padding: 2px 10px; border-radius: 10px;">
                        <i class="bi bi-check-circle me-1"></i>Entra ID
                    </span>
                }
                else
                {
                    <span style="background: #fff3e0; color: #e65100; font-weight: 600; padding: 2px 10px; border-radius: 10px;">
                        <i class="bi bi-exclamation-triangle me-1"></i>Development
                    </span>
                }
            </div>

            <!-- ASP.NET environment -->
            <div style="display: flex; justify-content: space-between; align-items: center; padding-bottom: 8px; border-bottom: 1px solid #f1f3f4;">
                <span style="color: #5f6368;"><i class="bi bi-gear me-1"></i>ASP.NET Env</span>
                <span style="background: #f3e5f5; color: #6a1b9a; font-weight: 600; padding: 2px 10px; border-radius: 10px;">@HostEnv.EnvironmentName</span>
            </div>

            <!-- Forwarded headers -->
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="color: #5f6368;"><i class="bi bi-arrow-left-right me-1"></i>Proxy Headers</span>
                @if (forwardedHeadersEnabled)
                {
                    <span style="background: #e8f5e9; color: #2e7d32; font-weight: 600; padding: 2px 10px; border-radius: 10px;">
                        <i class="bi bi-check-circle me-1"></i>Enabled
                    </span>
                }
                else
                {
                    <span style="background: #f5f5f5; color: #9e9e9e; font-weight: 600; padding: 2px 10px; border-radius: 10px;">Disabled</span>
                }
            </div>

        </div>
    </div>
</div>

<style>
.action-card {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    cursor: default;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid #e8eaed;
    display: flex;
    flex-direction: column;
}

.action-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    border-color: #0066cc;
}

.action-card.fade-in {
    animation: fadeIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

.fade-in {
    animation: fadeIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}
</style>

@code {
    private string appVersion = "unknown";
    private bool isContainer;
    private bool authEnabled;
    private bool forwardedHeadersEnabled;

    protected override void OnInitialized()
    {
        var versionFile = Path.Combine(AppContext.BaseDirectory, "VERSION");
        if (File.Exists(versionFile))
            appVersion = File.ReadAllText(versionFile).Trim();

        // Docker sets DOTNET_RUNNING_IN_CONTAINER=true; also check /.dockerenv as a fallback
        isContainer = string.Equals(Environment.GetEnvironmentVariable("DOTNET_RUNNING_IN_CONTAINER"), "true", StringComparison.OrdinalIgnoreCase)
                   || File.Exists("/.dockerenv");

        authEnabled = Configuration.GetValue<bool>("Authentication:Enabled", false);

        forwardedHeadersEnabled = string.Equals(
            Environment.GetEnvironmentVariable("ASPNETCORE_FORWARDEDHEADERS_ENABLED"), "true",
            StringComparison.OrdinalIgnoreCase);
    }
}
