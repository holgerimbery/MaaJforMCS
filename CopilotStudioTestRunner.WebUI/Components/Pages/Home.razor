@page "/"
@page "/home"
@layout MainLayout
@using CopilotStudioTestRunner.Data
@using Microsoft.EntityFrameworkCore
@using Microsoft.AspNetCore.Components.Web

<PageTitle>Copilot Studio Test Runner - Home</PageTitle>

<div style="margin-bottom: 48px;" class="fade-in">
    <h1 style="font-size: 32px; font-weight: 700; color: #1f1f23; margin: 0 0 8px 0;">What would you like to do?</h1>
    <p style="font-size: 15px; color: #5f5f5f; margin: 0; line-height: 1.5;">Choose an action below to get started with testing your Copilot Studio bot</p>
</div>

<!-- Action Cards Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 48px;">
    <div class="action-card fade-in" style="animation-delay: 0.1s;" @onclick="GoTestSuites">
        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #0066cc, #003d99); border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; flex-shrink: 0;">
            <i class="bi bi-list-check" style="font-size: 28px;"></i>
        </div>
        <h3 style="font-size: 16px; font-weight: 600; color: #1f1f23; margin: 0 0 8px 0;">Create Test Suite</h3>
        <p style="font-size: 14px; color: #5f5f5f; margin: 0; line-height: 1.5;">Build and manage test suites with AI-generated or manual test cases</p>
    </div>

    <div class="action-card fade-in" style="animation-delay: 0.2s;" @onclick="GoDocuments">
        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #8b5cf6, #6d28d9); border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; flex-shrink: 0;">
            <i class="bi bi-file-earmark-text" style="font-size: 28px;"></i>
        </div>
        <h3 style="font-size: 16px; font-weight: 600; color: #1f1f23; margin: 0 0 8px 0;">Upload Documents</h3>
        <p style="font-size: 14px; color: #5f5f5f; margin: 0; line-height: 1.5;">Upload documents to generate test questions or provide context</p>
    </div>

    <div class="action-card fade-in" style="animation-delay: 0.3s;" @onclick="GoDashboard">
        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #06b6d4, #0891b2); border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; flex-shrink: 0;">
            <i class="bi bi-graph-up" style="font-size: 28px;"></i>
        </div>
        <h3 style="font-size: 16px; font-weight: 600; color: #1f1f23; margin: 0 0 8px 0;">View Dashboard</h3>
        <p style="font-size: 14px; color: #5f5f5f; margin: 0; line-height: 1.5;">Monitor test results and view performance metrics</p>
    </div>

    <div class="action-card fade-in" style="animation-delay: 0.4s;" @onclick="GoWizard">
        <div style="width: 56px; height: 56px; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 12px; margin-bottom: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; flex-shrink: 0;">
            <i class="bi bi-magic" style="font-size: 28px;"></i>
        </div>
        <h3 style="font-size: 16px; font-weight: 600; color: #1f1f23; margin: 0 0 8px 0;">Setup Wizard</h3>
        <p style="font-size: 14px; color: #5f5f5f; margin: 0; line-height: 1.5;">Guided setup for DirectLine and Judge configuration</p>
    </div>
</div>

<!-- Getting Started Section -->
<div class="fade-in" style="background-color: #ffffff; border-radius: 12px; padding: 32px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 40px; border: 1px solid #e8eaed; animation-delay: 0.5s;">
    <h3 style="font-size: 18px; font-weight: 600; color: #1f1f23; margin: 0 0 24px 0;">Getting Started</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px;">
        <div style="display: flex; gap: 16px; animation-delay: 0.6s;" class="slide-in-left">
            <div style="width: 32px; height: 32px; background-color: #e6f0ff; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <span style="font-size: 16px; font-weight: 700; color: #0066cc;">1</span>
            </div>
            <div>
                <h4 style="font-size: 14px; font-weight: 600; color: #1f1f23; margin: 0 0 4px 0;">Configure Settings</h4>
                <p style="font-size: 13px; color: #5f5f5f; margin: 0; line-height: 1.5;">Set up your DirectLine secret and Judge (Azure OpenAI) endpoints</p>
            </div>
        </div>
        <div style="display: flex; gap: 16px; animation-delay: 0.7s;" class="slide-in-left">
            <div style="width: 32px; height: 32px; background-color: #f3e8ff; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <span style="font-size: 16px; font-weight: 700; color: #8b5cf6;">2</span>
            </div>
            <div>
                <h4 style="font-size: 14px; font-weight: 600; color: #1f1f23; margin: 0 0 4px 0;">Upload Documents</h4>
                <p style="font-size: 13px; color: #5f5f5f; margin: 0; line-height: 1.5;">Add documents to generate AI questions or provide context</p>
            </div>
        </div>
        <div style="display: flex; gap: 16px; animation-delay: 0.8s;" class="slide-in-left">
            <div style="width: 32px; height: 32px; background-color: #cffafe; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <span style="font-size: 16px; font-weight: 700; color: #06b6d4;">3</span>
            </div>
            <div>
                <h4 style="font-size: 14px; font-weight: 600; color: #1f1f23; margin: 0 0 4px 0;">Create Test Suites</h4>
                <p style="font-size: 13px; color: #5f5f5f; margin: 0; line-height: 1.5;">Build test suites with AI-generated or manually added questions</p>
            </div>
        </div>
        <div style="display: flex; gap: 16px; animation-delay: 0.9s;" class="slide-in-left">
            <div style="width: 32px; height: 32px; background-color: #fef3c7; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <span style="font-size: 16px; font-weight: 700; color: #f59e0b;">4</span>
            </div>
            <div>
                <h4 style="font-size: 14px; font-weight: 600; color: #1f1f23; margin: 0 0 4px 0;">Run Tests & Review</h4>
                <p style="font-size: 13px; color: #5f5f5f; margin: 0; line-height: 1.5;">Execute test suites and evaluate results with AI-powered Judge</p>
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats -->
@if (dbContext != null)
{
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px;">
        <div class="stat-card fade-in" style="animation-delay: 1s;">
            <div style="display: flex; align-items: flex-end; gap: 12px; margin-bottom: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: #0066cc;">@totalSuites</div>
                <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; color: #5f5f5f; letter-spacing: 0.5px;">Total</div>
            </div>
            <div style="font-size: 13px; color: #5f5f5f;">Test Suites</div>
        </div>
        <div class="stat-card fade-in" style="animation-delay: 1.1s;">
            <div style="display: flex; align-items: flex-end; gap: 12px; margin-bottom: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: #8b5cf6;">@totalDocuments</div>
                <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; color: #5f5f5f; letter-spacing: 0.5px;">Total</div>
            </div>
            <div style="font-size: 13px; color: #5f5f5f;">Documents</div>
        </div>
        <div class="stat-card fade-in" style="animation-delay: 1.2s;">
            <div style="display: flex; align-items: flex-end; gap: 12px; margin-bottom: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: #06b6d4;">@totalTestCases</div>
                <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; color: #5f5f5f; letter-spacing: 0.5px;">Total</div>
            </div>
            <div style="font-size: 13px; color: #5f5f5f;">Test Cases</div>
        </div>
        <div class="stat-card fade-in" style="animation-delay: 1.3s;">
            <div style="display: flex; align-items: flex-end; gap: 12px; margin-bottom: 8px;">
                <div style="font-size: 32px; font-weight: 700; color: #f59e0b;">@totalRuns</div>
                <div style="font-size: 11px; font-weight: 600; text-transform: uppercase; color: #5f5f5f; letter-spacing: 0.5px;">Total</div>
            </div>
            <div style="font-size: 13px; color: #5f5f5f;">Test Runs</div>
        </div>
    </div>
}

<style>
.action-card {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid #e8eaed;
    display: flex;
    flex-direction: column;
}

.action-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    border-color: #0066cc;
}

.action-card:active {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.08);
}

.action-card.fade-in {
    animation: fadeIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

.stat-card {
    background-color: #ffffff;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    border: 1px solid #e8eaed;
    transition: all 0.2s ease;
}

.stat-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.stat-card.fade-in {
    animation: fadeIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

.slide-in-left {
    animation: slideInLeft 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

.fade-in {
    animation: fadeIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}
</style>

@code {
    [Inject]
    private TestRunnerDbContext? dbContext { get; set; }
    
    [Inject]
    private NavigationManager? navigationManager { get; set; }

    private int totalSuites = 0;
    private int totalDocuments = 0;
    private int totalTestCases = 0;
    private int totalRuns = 0;

    protected override async Task OnInitializedAsync()
    {
        if (dbContext == null) return;

        try
        {
            totalSuites = await dbContext.TestSuites.CountAsync();
            totalDocuments = await dbContext.Documents.CountAsync();
            totalTestCases = await dbContext.TestCases.CountAsync();
            totalRuns = await dbContext.Runs.CountAsync();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading stats: {ex.Message}");
        }
    }

    private async Task NavigateTo(string path)
    {
        if (navigationManager != null)
        {
            navigationManager.NavigateTo(path);
            await Task.CompletedTask;
        }
    }

    private async Task GoTestSuites()
    {
        await NavigateTo("/test-suites");
    }

    private async Task GoDocuments()
    {
        await NavigateTo("/documents");
    }

    private async Task GoDashboard()
    {
        await NavigateTo("/dashboard");
    }

    private async Task GoWizard()
    {
        await NavigateTo("/wizard");
    }
}

